function Drawing(a){this.context=a}Drawing.NAME_FONT="14px Helvetica";Drawing.NAME_COLOR="black";Drawing.HP_COLOR="green";Drawing.HP_MISSING_COLOR="red";Drawing.BASE_IMG_URL="/static/img/";Drawing.SELF_TANK_SRC=Drawing.BASE_IMG_URL+"self_tank.png";Drawing.SELF_TURRET_SRC=Drawing.BASE_IMG_URL+"self_turret.png";Drawing.OTHER_TANK_SRC=Drawing.BASE_IMG_URL+"other_tank.png";Drawing.OTHER_TURRET_SRC=Drawing.BASE_IMG_URL+"other_turret.png";Drawing.SHIELD_SRC=Drawing.BASE_IMG_URL+"shield.png";
Drawing.BULLET_SRC=Drawing.BASE_IMG_URL+"bullet.png";Drawing.TILE_SRC=Drawing.BASE_IMG_URL+"tile.png";Drawing.TILE_SIZE=100;
Drawing.prototype.drawTank=function(a,b,c,d,e,g,f){this.context.save();this.context.translate(b[0],b[1]);this.context.textAlign="center";this.context.font=Drawing.NAME_FONT;this.context.fillStyle=Drawing.NAME_COLOR;this.context.fillText(e,0,-50);this.context.restore();this.context.save();this.context.translate(b[0],b[1]);for(e=0;10>e;e++)this.context.fillStyle=e<g?Drawing.HP_COLOR:Drawing.HP_MISSING_COLOR,this.context.fillRect(-25+5*e,-42,5,4);this.context.restore();this.context.save();this.context.translate(b[0],
b[1]);this.context.rotate(c);c=new Image;c.src=a?Drawing.SELF_TANK_SRC:Drawing.OTHER_TANK_SRC;this.context.drawImage(c,-c.width/2,-c.height/2);this.context.restore();this.context.save();this.context.translate(b[0],b[1]);this.context.rotate(d);d=new Image;d.src=a?Drawing.SELF_TURRET_SRC:Drawing.OTHER_TURRET_SRC;this.context.drawImage(d,-d.width/2,-d.height/2);this.context.restore();null!=f&&void 0!=f&&(this.context.save(),this.context.translate(b[0],b[1]),a=new Image,a.src=Drawing.SHIELD_SRC,this.context.drawImage(a,
-a.width/2,-a.height/2),this.context.restore())};Drawing.prototype.drawBullet=function(a,b){this.context.save();this.context.translate(a[0],a[1]);this.context.rotate(b);var c=new Image;c.src=Drawing.BULLET_SRC;this.context.drawImage(c,-c.width/2,-c.height/2);this.context.restore()};Drawing.prototype.drawPowerup=function(a,b){this.context.save();this.context.translate(a[0],a[1]);var c=new Image;c.src=Drawing.BASE_IMG_URL+b+".png";this.context.drawImage(c,-c.width/2,-c.height/2);this.context.restore()};
Drawing.prototype.drawTiles=function(a,b){this.context.save();var c=new Image;c.src=Drawing.TILE_SRC;for(var d=a[0];d<b[0];d+=Drawing.TILE_SIZE)for(var e=a[1];e<b[1];e+=Drawing.TILE_SIZE)this.context.drawImage(c,d,e);this.context.restore()};function Environment(a,b){this.viewPort=a;this.drawing=b}Environment.MIN=0;Environment.MAX=2500;
Environment.prototype.draw=function(){var a=this.viewPort.selfCoords;this.drawing.drawTiles(this.viewPort.toCanvasCoords({x:Math.max(Math.floor((a[0]-Game.WIDTH/2)/Drawing.TILE_SIZE)*Drawing.TILE_SIZE,Environment.MIN),y:Math.max(Math.floor((a[1]-Game.HEIGHT/2)/Drawing.TILE_SIZE)*Drawing.TILE_SIZE,Environment.MIN)}),this.viewPort.toCanvasCoords({x:Math.min((Math.ceil((a[0]+Game.WIDTH/2)/Drawing.TILE_SIZE)+1)*Drawing.TILE_SIZE,Environment.MAX),y:Math.min((Math.ceil((a[1]+Game.HEIGHT/2)/Drawing.TILE_SIZE)+
1)*Drawing.TILE_SIZE,Environment.MAX)}))};function Game(a,b){this.canvas=a;this.canvas.width=Game.WIDTH;this.canvas.height=Game.HEIGHT;this.canvasContext=this.canvas.getContext("2d");this.socket=b;this.id=null;this.packetNumber=0;this.drawing=new Drawing(this.canvasContext);this.viewPort=new ViewPort;this.environment=new Environment(this.viewPort,this.drawing);this.self=null;this.players=[];this.projectiles=[];this.powerups=[];this.explosions=[]}Game.WIDTH=800;Game.HEIGHT=600;Game.prototype.setID=function(a){this.id=a};
Game.prototype.getPlayers=function(){var a=JSON.parse(JSON.stringify(this.players)),b=JSON.parse(JSON.stringify(this.self));return b?a.concat(b):[]};Game.prototype.receiveGameState=function(a){this.self=a.self;this.players=a.players;this.projectiles=a.projectiles;this.powerups=a.powerups;this.explosions=a.explosions};
Game.prototype.update=function(){if(this.self){this.viewPort.update(this.self.x,this.self.y);var a={keyboardState:{up:Input.UP,right:Input.RIGHT,down:Input.DOWN,left:Input.LEFT},turretAngle:Math.atan2(Input.MOUSE[1]-Game.HEIGHT/2,Input.MOUSE[0]-Game.WIDTH/2)+Math.PI/2,shot:Input.LEFT_CLICK,packetNumber:this.packetNumber++,timestamp:(new Date).getTime()};this.socket.emit("player-action",a)}};
Game.prototype.draw=function(){this.canvasContext.clearRect(0,0,Game.WIDTH,Game.HEIGHT);this.environment.draw();for(var a=0;a<this.projectiles.length;++a)this.drawing.drawBullet(this.viewPort.toCanvasCoords(this.projectiles[a]),this.projectiles[a].direction);for(a=0;a<this.powerups.length;++a)this.drawing.drawPowerup(this.viewPort.toCanvasCoords(this.powerups[a]),this.powerups[a].name);this.self&&this.drawing.drawTank(!0,this.viewPort.toCanvasCoords(this.self),this.self.orientation,this.self.turretAngle,
this.self.name,this.self.health,this.self.powerups.shield_powerup);for(a=0;a<this.players.length;++a)this.drawing.drawTank(!1,this.viewPort.toCanvasCoords(this.players[a]),this.players[a].orientation,this.players[a].turretAngle,this.players[a].name,this.players[a].health,this.players[a].powerups.shield_powerup)};function Input(){}Input.LEFT_CLICK=!1;Input.RIGHT_CLICK=!1;Input.MOUSE=[];Input.LEFT=!1;Input.UP=!1;Input.RIGHT=!1;Input.DOWN=!1;Input.onMouseDown=function(a){1==a.which?Input.LEFT_CLICK=!0:3==a.which&&(Input.RIGHT_CLICK=!0)};Input.onMouseUp=function(a){1==a.which?Input.LEFT_CLICK=!1:3==a.which&&(Input.RIGHT_CLICK=!1)};Input.onMouseMove=function(a){var b=document.getElementById("canvas").getBoundingClientRect();Input.MOUSE=[a.pageX-b.left,a.pageY-b.top]};
Input.onKeyDown=function(a){switch(a.keyCode){case 37:case 65:Input.LEFT=!0;break;case 38:case 87:Input.UP=!0;break;case 39:case 68:Input.RIGHT=!0;break;case 40:case 83:Input.DOWN=!0}};Input.onKeyUp=function(a){switch(a.keyCode){case 37:case 65:Input.LEFT=!1;break;case 38:case 87:Input.UP=!1;break;case 39:case 68:Input.RIGHT=!1;break;case 40:case 83:Input.DOWN=!1}};
Input.applyEventHandlers=function(){window.addEventListener("mousedown",Input.onMouseDown);window.addEventListener("mouseup",Input.onMouseUp);window.addEventListener("mousemove",Input.onMouseMove);window.addEventListener("keyup",Input.onKeyUp);window.addEventListener("keydown",Input.onKeyDown)};function Kill_Announcer(a){this.feed=a};function Leaderboard(a){this.element=a;this.players=null}Leaderboard.prototype.update=function(a){this.players=a;this.players.sort(function(a,c){return c.score>a.score});this.element.empty();for(a=0;a<Math.min(this.players.length,10);++a)this.element.append($("<li>").text(this.players[a].name+": "+this.players[a].kills))};function ViewPort(){this.selfCoords=[]}ViewPort.prototype.update=function(a,b){this.selfCoords=[a,b]};ViewPort.prototype.toCanvasCoords=function(a){return[a.x-(this.selfCoords[0]-Game.WIDTH/2),a.y-(this.selfCoords[1]-Game.HEIGHT/2)]};
